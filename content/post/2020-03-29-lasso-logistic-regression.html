---
title: Predict the product recommended
author: Scott Miner
date: '2020-03-29'
slug: lasso-logistic-regression
categories:
  - Text-Mining
tags: []
---



<div id="feature-extraction" class="section level4">
<h4>Feature Extraction</h4>
<p>We will try 3 of the most popular classification algorithms – CART, Random forest and Lasso logistic regression.</p>
<pre class="r"><code>## Load the required libraries
library(irlba)
library(e1071)
library(caret)
library(randomForest)
library(rpart)
library(rpart.plot)
library(ggplot2)
library(SnowballC)
library(RColorBrewer)
library(wordcloud)
library(biclust)
library(igraph)
library(fpc)
library(Rcampdf)</code></pre>
</div>
<div id="tokenisation" class="section level4">
<h4>Tokenisation</h4>
<p>Tokenisation is the process of decomposing text into distinct pieces or tokens.</p>
<p>Once tokenisation is done, it is possible to construct a dataframe where each row represents a document and each column represents a token and each cell gives the count of the token for a document.</p>
<p>This is the DTM that we learnt in the previous section.</p>
<pre class="r"><code>review=read.csv(&quot;~/OneDrive/Documents/datasets/womens-ecommerce-clothing-reviews/Womens Clothing E-Commerce Reviews.csv&quot;, stringsAsFactors = FALSE)

# Tokenize description
reviewtokens=tokens(review$Review.Text,what=&quot;word&quot;,
                    remove_numbers=TRUE,
                    remove_punct=TRUE,
                    remove_symbols=TRUE,
                    split_hyphens=TRUE)

# Lowercase the tokens
reviewtokens=tokens_tolower(reviewtokens)

# remove stop words and unnecessary words
rmwords &lt;- c(&quot;dress&quot;, &quot;etc&quot;, &quot;also&quot;, &quot;xxs&quot;, &quot;xs&quot;, &quot;s&quot;)
reviewtokens=tokens_select(reviewtokens, stopwords(),selection = &quot;remove&quot;)
reviewtokens=tokens_remove(reviewtokens,rmwords)

# Stemming tokens
reviewtokens=tokens_wordstem(reviewtokens,language = &quot;english&quot;)
reviewtokens=tokens_ngrams(reviewtokens,n=1:2)</code></pre>
<p>Tokens are now converted to a document frequency matrix and treated for sparsity.</p>
<pre class="r"><code>reviewtokensdfm=dfm(reviewtokens,tolower = FALSE)

# Remove sparsity
reviewSparse &lt;- convert(reviewtokensdfm, &quot;tm&quot;)
tm::removeSparseTerms(reviewSparse, 0.7)</code></pre>
<pre><code>## &lt;&lt;DocumentTermMatrix (documents: 23486, terms: 4)&gt;&gt;
## Non-/sparse entries: 33027/60917
## Sparsity           : 65%
## Maximal term length: 4
## Weighting          : term frequency (tf)</code></pre>
<pre class="r"><code># Create the dfm
dfm_trim(reviewtokensdfm, min_docfreq = 0.3)</code></pre>
<pre><code>## Document-feature matrix of: 23,486 documents, 238,120 features (100.0% sparse).
##        features
## docs    absolut wonder silki sexi comfort absolut_wonder wonder_silki
##   text1       1      1     1    1       1              1            1
##   text2       0      0     0    0       0              0            0
##   text3       0      0     0    0       1              0            0
##   text4       0      0     0    0       0              0            0
##   text5       0      0     0    0       0              0            0
##   text6       0      0     0    0       0              0            0
##        features
## docs    silki_sexi sexi_comfort love
##   text1          1            1    0
##   text2          0            0    2
##   text3          0            0    0
##   text4          0            0    3
##   text5          0            0    1
##   text6          0            0    2
## [ reached max_ndoc ... 23,480 more documents, reached max_nfeat ... 238,110 more features ]</code></pre>
<pre class="r"><code>x=dfm_trim(reviewtokensdfm, sparsity = 0.98)</code></pre>
</div>
<div id="step6-building-the-classification-models" class="section level4">
<h4>STEP6 Building the Classification Models</h4>
<p>We now have the pre-processed, treated and ready to be used for classification - dataframe.</p>
<p>The following steps are carried out:</p>
<ol style="list-style-type: decimal">
<li>Convert the dfm into a dataframe</li>
<li>Add the “Y” variable to the converted dataframe</li>
<li>Cleanup the column names so that they are compatible with r</li>
<li>Remove the original review.text column since we already have this as converted columns.</li>
</ol>
<pre class="r"><code>## Setup a dataframe with features
df=convert(x,to=&quot;data.frame&quot;)

##Add the Y variable Recommend.IND
reviewtokensdf=cbind(review$Recommended.IND,df)
head(reviewtokensdf)</code></pre>
<pre><code>##   review$Recommended.IND document absolut wonder comfort love pretti find store
## 1                      1    text1       1      1       1    0      0    0     0
## 2                      1    text2       0      0       0    2      1    1     1
## 3                      0    text3       0      0       1    0      0    0     0
## 4                      1    text4       0      0       0    3      0    0     0
## 5                      1    text5       0      0       0    1      0    0     0
## 6                      0    text6       0      0       0    2      1    0     0
##   glad order onlin petit bought length hit just littl knee definit true high
## 1    0     0     0     0      0      0   0    0     0    0       0    0    0
## 2    1     1     1     3      1      1   1    1     1    1       1    1    0
## 3    0     1     0     2      0      0   0    1     0    0       0    0    1
## 4    0     0     0     0      0      0   0    0     0    0       0    0    0
## 5    0     0     0     0      0      1   0    0     0    0       0    0    0
## 6    0     0     0     1      0      0   0    2     0    0       0    0    0
##   hope realli want work small usual size found medium overal top fit nice
## 1    0      0    0    0     0     0    0     0      0      0   0   0    0
## 2    0      0    0    0     0     0    0     0      0      0   0   0    0
## 3    1      1    1    1     3     1    1     1      1      1   1   1    1
## 4    0      0    0    0     0     0    0     0      0      0   0   0    0
## 5    0      0    0    0     0     0    0     0      0      0   0   0    0
## 6    0      0    0    1     1     1    0     0      0      0   0   0    0
##   bottom tight layer design usual_size well fall wish tie around waist flat
## 1      0     0     0      0          0    0    0    0   0      0     0    0
## 2      0     0     0      0          0    0    0    0   0      0     0    0
## 3      1     1     3      1          1    0    0    0   0      0     0    0
## 4      0     0     0      0          0    0    0    0   0      0     0    0
## 5      0     0     0      0          0    1    0    0   1      0     0    0
## 6      0     0     0      0          0    0    0    0   0      0     0    0
##   style like model fun get flatter look everi color time wear fabric great
## 1     0    0     0   0   0       0    0     0     0    0    0      0     0
## 2     0    0     0   0   0       0    0     0     0    0    0      0     0
## 3     0    0     0   0   0       0    0     0     0    0    0      0     0
## 4     0    0     0   1   1       0    0     1     0    1    1      0     1
## 5     0    0     0   0   0       1    0     0     0    0    1      0     0
## 6     1    0     0   0   0       0    0     0     1    0    1      0     0
##   compliment qualiti person happi shirt front perfect leg pair dress one tall
## 1          0       0      0     0     0     0       0   0    0     0   0    0
## 2          0       0      0     0     0     0       0   0    0     0   0    0
## 3          0       0      0     0     0     0       0   0    0     0   0    0
## 4          1       0      0     0     0     0       0   0    0     0   0    0
## 5          0       0      0     0     2     1       1   1    1     0   0    0
## 6          0       0      0     0     0     0       0   0    0     1   1    1
##   lot skirt long full take return jean wash show better navi almost someth
## 1   0     0    0    0    0      0    0    0    0      0    0      0      0
## 2   0     0    0    0    0      0    0    0    0      0    0      0      0
## 3   0     0    0    0    0      0    0    0    0      0    0      0      0
## 4   0     0    0    0    0      0    0    0    0      0    0      0      0
## 5   0     0    0    0    0      0    0    0    0      0    0      0      0
## 6   1     2    1    1    1      1    0    0    0      0    0      0      0
##   usual_wear white red loos love_color see went gorgeous sure tri issu decid
## 1          0     0   0    0          0   0    0        0    0   0    0     0
## 2          0     0   0    0          0   0    0        0    0   0    0     0
## 3          0     0   0    0          0   0    0        0    0   0    0     0
## 4          0     0   0    0          0   0    0        0    0   0    0     0
## 5          0     0   0    0          0   0    0        0    0   0    0     0
## 6          1     0   0    0          1   0    0        0    0   0    0     0
##   review though good said everyth versatil pant worn short make look_like
## 1      0      0    0    0       0        0    0    0     0    0         0
## 2      0      0    0    0       0        0    0    0     0    0         0
## 3      0      0    0    0       0        0    0    0     0    0         0
## 4      0      0    0    0       0        0    0    0     0    0         0
## 5      0      0    0    0       0        0    0    0     0    0         0
## 6      0      0    0    0       0        0    0    0     0    0         0
##   underneath alway use mani bit big sleev go end worth got quit sinc light buy
## 1          0     0   0    0   0   0     0  0   0     0   0    0    0     0   0
## 2          0     0   0    0   0   0     0  0   0     0   0    0    0     0   0
## 3          0     0   0    0   0   0     0  0   0     0   0    0    0     0   0
## 4          0     0   0    0   0   0     0  0   0     0   0    0    0     0   0
## 5          0     0   0    0   0   0     0  0   0     0   0    0    0     0   0
## 6          0     0   0    0   0   0     0  0   0     0   0    0    0     0   0
##   feel think feel_like pictur even huge sweater beauti run will snug back bust
## 1    0     0         0      0    0    0       0      0   0    0    0    0    0
## 2    0     0         0      0    0    0       0      0   0    0    0    0    0
## 3    0     0         0      0    0    0       0      0   0    0    0    0    0
## 4    0     0         0      0    0    0       0      0   0    0    0    0    0
## 5    0     0         0      0    0    0       0      0   0    0    0    0    0
## 6    0     0         0      0    0    0       0      0   0    0    0    0    0
##   feminin retail order_size lbs typic regular tee soft smaller thin longer
## 1       0      0          0   0     0       0   0    0       0    0      0
## 2       0      0          0   0     0       0   0    0       0    0      0
## 3       0      0          0   0     0       0   0    0       0    0      0
## 4       0      0          0   0     0       0   0    0       0    0      0
## 5       0      0          0   0     0       0   0    0       0    0      0
## 6       0      0          0   0     0       0   0    0       0    0      0
##   summer area larger normal say fine room sheer bra easili fit_perfect materi
## 1      0    0      0      0   0    0    0     0   0      0           0      0
## 2      0    0      0      0   0    0    0     0   0      0           0      0
## 3      0    0      0      0   0    0    0     0   0      0           0      0
## 4      0    0      0      0   0    0    0     0   0      0           0      0
## 5      0    0      0      0   0    0    0     0   0      0           0      0
## 6      0    0      0      0   0    0    0     0   0      0           0      0
##   pull disappoint year shape super flowi spring first look_great right made
## 1    0          0    0     0     0     0      0     0          0     0    0
## 2    0          0    0     0     0     0      0     0          0     0    0
## 3    0          0    0     0     0     0      0     0          0     0    0
## 4    0          0    0     0     0     0      0     0          0     0    0
## 5    0          0    0     0     0     0      0     0          0     0    0
## 6    0          0    0     0     0     0      0     0          0     0    0
##   line print tts lace blue keep pocket black chest came seem much enough
## 1    0     0   0    0    0    0      0     0     0    0    0    0      0
## 2    0     0   0    0    0    0      0     0     0    0    0    0      0
## 3    0     0   0    0    0    0      0     0     0    0    0    0      0
## 4    0     0   0    0    0    0      0     0     0    0    0    0      0
## 5    0     0   0    0    0    0      0     0     0    0    0    0      0
## 6    0     0   0    0    0    0      0     0     0    0    0    0      0
##   problem boot size_small fit_well especi sale price now purchas put figur way
## 1       0    0          0        0      0    0     0   0       0   0     0   0
## 2       0    0          0        0      0    0     0   0       0   0     0   0
## 3       0    0          0        0      0    0     0   0       0   0     0   0
## 4       0    0          0        0      0    0     0   0       0   0     0   0
## 5       0    0          0        0      0    0     0   0       0   0     0   0
## 6       0    0          0        0      0    0     0   0       0   0     0   0
##   bodi still hip cute receiv can side well_made thought uniqu t open larg part
## 1    0     0   0    0      0   0    0         0       0     0 0    0    0    0
## 2    0     0   0    0      0   0    0         0       0     0 0    0    0    0
## 3    0     0   0    0      0   0    0         0       0     0 0    0    0    0
## 4    0     0   0    0      0   0    0         0       0     0 0    0    0    0
## 5    0     0   0    0      0   0    0         0       0     0 0    0    0    0
## 6    0     0   0    0      0   0    0         0       0     0 0    0    0    0
##   hem may blous drape wait come pattern fit_great thing skinni arm probabl
## 1   0   0     0     0    0    0       0         0     0      0   0       0
## 2   0   0     0     0    0    0       0         0     0      0   0       0
## 3   0   0     0     0    0    0       0         0     0      0   0       0
## 4   0   0     0     0    0    0       0         0     0      0   0       0
## 5   0   0     0     0    0    0       0         0     0      0   0       0
## 6   0   0     0     0    0    0       0         0     0      0   0       0
##   button shoulder give slight day differ favorit jacket 5&#39;4 without detail
## 1      0        0    0      0   0      0       0      0   0       0      0
## 2      0        0    0      0   0      0       0      0   0       0      0
## 3      0        0    0      0   0      0       0      0   0       0      0
## 4      0        0    0      0   0      0       0      0   0       0      0
## 5      0        0    0      0   0      0       0      0   0       0      0
## 6      0        0    0      0   0      0       0      0   0       0      0
##   weight comfi winter fit_true two true_size stretch recommend sad need photo
## 1      0     0      0        0   0         0       0         0   0    0     0
## 2      0     0      0        0   0         0       0         0   0    0     0
## 3      0     0      0        0   0         0       0         0   0    0     0
## 4      0     0      0        0   0         0       0         0   0    0     0
## 5      0     0      0        0   0         0       0         0   0    0     0
## 6      0     0      0        0   0         0       0         0   0    0     0
##   saw wore 5&#39;3 yet tank piec felt cut wide refer expect thick love_top actual
## 1   0    0   0   0    0    0    0   0    0     0      0     0        0      0
## 2   0    0   0   0    0    0    0   0    0     0      0     0        0      0
## 3   0    0   0   0    0    0    0   0    0     0      0     0        0      0
## 4   0    0   0   0    0    0    0   0    0     0      0     0        0      0
## 5   0    0   0   0    0    0    0   0    0     0      0     0        0      0
## 6   0    0   0   0    0    0    0   0    0     0      0     0        0      0
##   extra boxi size_fit warm shorter add anoth cloth neck amaz casual necklin
## 1     0    0        0    0       0   0     0     0    0    0      0       0
## 2     0    0        0    0       0   0     0     0    0    0      0       0
## 3     0    0        0    0       0   0     0     0    0    0      0       0
## 4     0    0        0    0       0   0     0     0    0    0      0       0
## 5     0    0        0    0       0   0     0     0    0    0      0       0
## 6     0    0        0    0       0   0     0     0    0    0      0       0
##   unfortun might ador best m know hang lightweight howev surpris heavi flow
## 1        0     0    0    0 0    0    0           0     0       0     0    0
## 2        0     0    0    0 0    0    0           0     0       0     0    0
## 3        0     0    0    0 0    0    0           0     0       0     0    0
## 4        0     0    0    0 0    0    0           0     0       0     0    0
## 5        0     0    0    0 0    0    0           0     0       0     0    0
## 6        0     0    0    0 0    0    0           0     0       0     0    0
##   run_larg green easi low mayb denim slim
## 1        0     0    0   0    0     0    0
## 2        0     0    0   0    0     0    0
## 3        0     0    0   0    0     0    0
## 4        0     0    0   0    0     0    0
## 5        0     0    0   0    0     0    0
## 6        0     0    0   0    0     0    0</code></pre>
<pre class="r"><code>## Cleanup names
names(reviewtokensdf)[names(reviewtokensdf) == &quot;review$Recommended.IND&quot;] &lt;- &quot;recommend&quot;
names(reviewtokensdf)=make.names(names(reviewtokensdf))
head(reviewtokensdf)</code></pre>
<pre><code>##   recommend document absolut wonder comfort love pretti find store glad order
## 1         1    text1       1      1       1    0      0    0     0    0     0
## 2         1    text2       0      0       0    2      1    1     1    1     1
## 3         0    text3       0      0       1    0      0    0     0    0     1
## 4         1    text4       0      0       0    3      0    0     0    0     0
## 5         1    text5       0      0       0    1      0    0     0    0     0
## 6         0    text6       0      0       0    2      1    0     0    0     0
##   onlin petit bought length hit just littl knee definit true high hope realli
## 1     0     0      0      0   0    0     0    0       0    0    0    0      0
## 2     1     3      1      1   1    1     1    1       1    1    0    0      0
## 3     0     2      0      0   0    1     0    0       0    0    1    1      1
## 4     0     0      0      0   0    0     0    0       0    0    0    0      0
## 5     0     0      0      1   0    0     0    0       0    0    0    0      0
## 6     0     1      0      0   0    2     0    0       0    0    0    0      0
##   want work small usual size found medium overal top fit nice bottom tight
## 1    0    0     0     0    0     0      0      0   0   0    0      0     0
## 2    0    0     0     0    0     0      0      0   0   0    0      0     0
## 3    1    1     3     1    1     1      1      1   1   1    1      1     1
## 4    0    0     0     0    0     0      0      0   0   0    0      0     0
## 5    0    0     0     0    0     0      0      0   0   0    0      0     0
## 6    0    1     1     1    0     0      0      0   0   0    0      0     0
##   layer design usual_size well fall wish tie around waist flat style like model
## 1     0      0          0    0    0    0   0      0     0    0     0    0     0
## 2     0      0          0    0    0    0   0      0     0    0     0    0     0
## 3     3      1          1    0    0    0   0      0     0    0     0    0     0
## 4     0      0          0    0    0    0   0      0     0    0     0    0     0
## 5     0      0          0    1    0    0   1      0     0    0     0    0     0
## 6     0      0          0    0    0    0   0      0     0    0     1    0     0
##   fun get flatter look everi color time wear fabric great compliment qualiti
## 1   0   0       0    0     0     0    0    0      0     0          0       0
## 2   0   0       0    0     0     0    0    0      0     0          0       0
## 3   0   0       0    0     0     0    0    0      0     0          0       0
## 4   1   1       0    0     1     0    1    1      0     1          1       0
## 5   0   0       1    0     0     0    0    1      0     0          0       0
## 6   0   0       0    0     0     1    0    1      0     0          0       0
##   person happi shirt front perfect leg pair dress one tall lot skirt long full
## 1      0     0     0     0       0   0    0     0   0    0   0     0    0    0
## 2      0     0     0     0       0   0    0     0   0    0   0     0    0    0
## 3      0     0     0     0       0   0    0     0   0    0   0     0    0    0
## 4      0     0     0     0       0   0    0     0   0    0   0     0    0    0
## 5      0     0     2     1       1   1    1     0   0    0   0     0    0    0
## 6      0     0     0     0       0   0    0     1   1    1   1     2    1    1
##   take return jean wash show better navi almost someth usual_wear white red
## 1    0      0    0    0    0      0    0      0      0          0     0   0
## 2    0      0    0    0    0      0    0      0      0          0     0   0
## 3    0      0    0    0    0      0    0      0      0          0     0   0
## 4    0      0    0    0    0      0    0      0      0          0     0   0
## 5    0      0    0    0    0      0    0      0      0          0     0   0
## 6    1      1    0    0    0      0    0      0      0          1     0   0
##   loos love_color see went gorgeous sure tri issu decid review though good said
## 1    0          0   0    0        0    0   0    0     0      0      0    0    0
## 2    0          0   0    0        0    0   0    0     0      0      0    0    0
## 3    0          0   0    0        0    0   0    0     0      0      0    0    0
## 4    0          0   0    0        0    0   0    0     0      0      0    0    0
## 5    0          0   0    0        0    0   0    0     0      0      0    0    0
## 6    0          1   0    0        0    0   0    0     0      0      0    0    0
##   everyth versatil pant worn short make look_like underneath alway use mani bit
## 1       0        0    0    0     0    0         0          0     0   0    0   0
## 2       0        0    0    0     0    0         0          0     0   0    0   0
## 3       0        0    0    0     0    0         0          0     0   0    0   0
## 4       0        0    0    0     0    0         0          0     0   0    0   0
## 5       0        0    0    0     0    0         0          0     0   0    0   0
## 6       0        0    0    0     0    0         0          0     0   0    0   0
##   big sleev go end worth got quit sinc light buy feel think feel_like pictur
## 1   0     0  0   0     0   0    0    0     0   0    0     0         0      0
## 2   0     0  0   0     0   0    0    0     0   0    0     0         0      0
## 3   0     0  0   0     0   0    0    0     0   0    0     0         0      0
## 4   0     0  0   0     0   0    0    0     0   0    0     0         0      0
## 5   0     0  0   0     0   0    0    0     0   0    0     0         0      0
## 6   0     0  0   0     0   0    0    0     0   0    0     0         0      0
##   even huge sweater beauti run will snug back bust feminin retail order_size
## 1    0    0       0      0   0    0    0    0    0       0      0          0
## 2    0    0       0      0   0    0    0    0    0       0      0          0
## 3    0    0       0      0   0    0    0    0    0       0      0          0
## 4    0    0       0      0   0    0    0    0    0       0      0          0
## 5    0    0       0      0   0    0    0    0    0       0      0          0
## 6    0    0       0      0   0    0    0    0    0       0      0          0
##   lbs typic regular tee soft smaller thin longer summer area larger normal say
## 1   0     0       0   0    0       0    0      0      0    0      0      0   0
## 2   0     0       0   0    0       0    0      0      0    0      0      0   0
## 3   0     0       0   0    0       0    0      0      0    0      0      0   0
## 4   0     0       0   0    0       0    0      0      0    0      0      0   0
## 5   0     0       0   0    0       0    0      0      0    0      0      0   0
## 6   0     0       0   0    0       0    0      0      0    0      0      0   0
##   fine room sheer bra easili fit_perfect materi pull disappoint year shape
## 1    0    0     0   0      0           0      0    0          0    0     0
## 2    0    0     0   0      0           0      0    0          0    0     0
## 3    0    0     0   0      0           0      0    0          0    0     0
## 4    0    0     0   0      0           0      0    0          0    0     0
## 5    0    0     0   0      0           0      0    0          0    0     0
## 6    0    0     0   0      0           0      0    0          0    0     0
##   super flowi spring first look_great right made line print tts lace blue keep
## 1     0     0      0     0          0     0    0    0     0   0    0    0    0
## 2     0     0      0     0          0     0    0    0     0   0    0    0    0
## 3     0     0      0     0          0     0    0    0     0   0    0    0    0
## 4     0     0      0     0          0     0    0    0     0   0    0    0    0
## 5     0     0      0     0          0     0    0    0     0   0    0    0    0
## 6     0     0      0     0          0     0    0    0     0   0    0    0    0
##   pocket black chest came seem much enough problem boot size_small fit_well
## 1      0     0     0    0    0    0      0       0    0          0        0
## 2      0     0     0    0    0    0      0       0    0          0        0
## 3      0     0     0    0    0    0      0       0    0          0        0
## 4      0     0     0    0    0    0      0       0    0          0        0
## 5      0     0     0    0    0    0      0       0    0          0        0
## 6      0     0     0    0    0    0      0       0    0          0        0
##   especi sale price now purchas put figur way bodi still hip cute receiv can
## 1      0    0     0   0       0   0     0   0    0     0   0    0      0   0
## 2      0    0     0   0       0   0     0   0    0     0   0    0      0   0
## 3      0    0     0   0       0   0     0   0    0     0   0    0      0   0
## 4      0    0     0   0       0   0     0   0    0     0   0    0      0   0
## 5      0    0     0   0       0   0     0   0    0     0   0    0      0   0
## 6      0    0     0   0       0   0     0   0    0     0   0    0      0   0
##   side well_made thought uniqu t open larg part hem may blous drape wait come
## 1    0         0       0     0 0    0    0    0   0   0     0     0    0    0
## 2    0         0       0     0 0    0    0    0   0   0     0     0    0    0
## 3    0         0       0     0 0    0    0    0   0   0     0     0    0    0
## 4    0         0       0     0 0    0    0    0   0   0     0     0    0    0
## 5    0         0       0     0 0    0    0    0   0   0     0     0    0    0
## 6    0         0       0     0 0    0    0    0   0   0     0     0    0    0
##   pattern fit_great thing skinni arm probabl button shoulder give slight day
## 1       0         0     0      0   0       0      0        0    0      0   0
## 2       0         0     0      0   0       0      0        0    0      0   0
## 3       0         0     0      0   0       0      0        0    0      0   0
## 4       0         0     0      0   0       0      0        0    0      0   0
## 5       0         0     0      0   0       0      0        0    0      0   0
## 6       0         0     0      0   0       0      0        0    0      0   0
##   differ favorit jacket X5.4 without detail weight comfi winter fit_true two
## 1      0       0      0    0       0      0      0     0      0        0   0
## 2      0       0      0    0       0      0      0     0      0        0   0
## 3      0       0      0    0       0      0      0     0      0        0   0
## 4      0       0      0    0       0      0      0     0      0        0   0
## 5      0       0      0    0       0      0      0     0      0        0   0
## 6      0       0      0    0       0      0      0     0      0        0   0
##   true_size stretch recommend sad need photo saw wore X5.3 yet tank piec felt
## 1         0       0         0   0    0     0   0    0    0   0    0    0    0
## 2         0       0         0   0    0     0   0    0    0   0    0    0    0
## 3         0       0         0   0    0     0   0    0    0   0    0    0    0
## 4         0       0         0   0    0     0   0    0    0   0    0    0    0
## 5         0       0         0   0    0     0   0    0    0   0    0    0    0
## 6         0       0         0   0    0     0   0    0    0   0    0    0    0
##   cut wide refer expect thick love_top actual extra boxi size_fit warm shorter
## 1   0    0     0      0     0        0      0     0    0        0    0       0
## 2   0    0     0      0     0        0      0     0    0        0    0       0
## 3   0    0     0      0     0        0      0     0    0        0    0       0
## 4   0    0     0      0     0        0      0     0    0        0    0       0
## 5   0    0     0      0     0        0      0     0    0        0    0       0
## 6   0    0     0      0     0        0      0     0    0        0    0       0
##   add anoth cloth neck amaz casual necklin unfortun might ador best m know hang
## 1   0     0     0    0    0      0       0        0     0    0    0 0    0    0
## 2   0     0     0    0    0      0       0        0     0    0    0 0    0    0
## 3   0     0     0    0    0      0       0        0     0    0    0 0    0    0
## 4   0     0     0    0    0      0       0        0     0    0    0 0    0    0
## 5   0     0     0    0    0      0       0        0     0    0    0 0    0    0
## 6   0     0     0    0    0      0       0        0     0    0    0 0    0    0
##   lightweight howev surpris heavi flow run_larg green easi low mayb denim slim
## 1           0     0       0     0    0        0     0    0   0    0     0    0
## 2           0     0       0     0    0        0     0    0   0    0     0    0
## 3           0     0       0     0    0        0     0    0   0    0     0    0
## 4           0     0       0     0    0        0     0    0   0    0     0    0
## 5           0     0       0     0    0        0     0    0   0    0     0    0
## 6           0     0       0     0    0        0     0    0   0    0     0    0</code></pre>
<pre class="r"><code>## Remove the original review.text column
reviewtokensdf=reviewtokensdf[,-c(2)]
head(reviewtokensdf)</code></pre>
<pre><code>##   recommend absolut wonder comfort love pretti find store glad order onlin
## 1         1       1      1       1    0      0    0     0    0     0     0
## 2         1       0      0       0    2      1    1     1    1     1     1
## 3         0       0      0       1    0      0    0     0    0     1     0
## 4         1       0      0       0    3      0    0     0    0     0     0
## 5         1       0      0       0    1      0    0     0    0     0     0
## 6         0       0      0       0    2      1    0     0    0     0     0
##   petit bought length hit just littl knee definit true high hope realli want
## 1     0      0      0   0    0     0    0       0    0    0    0      0    0
## 2     3      1      1   1    1     1    1       1    1    0    0      0    0
## 3     2      0      0   0    1     0    0       0    0    1    1      1    1
## 4     0      0      0   0    0     0    0       0    0    0    0      0    0
## 5     0      0      1   0    0     0    0       0    0    0    0      0    0
## 6     1      0      0   0    2     0    0       0    0    0    0      0    0
##   work small usual size found medium overal top fit nice bottom tight layer
## 1    0     0     0    0     0      0      0   0   0    0      0     0     0
## 2    0     0     0    0     0      0      0   0   0    0      0     0     0
## 3    1     3     1    1     1      1      1   1   1    1      1     1     3
## 4    0     0     0    0     0      0      0   0   0    0      0     0     0
## 5    0     0     0    0     0      0      0   0   0    0      0     0     0
## 6    1     1     1    0     0      0      0   0   0    0      0     0     0
##   design usual_size well fall wish tie around waist flat style like model fun
## 1      0          0    0    0    0   0      0     0    0     0    0     0   0
## 2      0          0    0    0    0   0      0     0    0     0    0     0   0
## 3      1          1    0    0    0   0      0     0    0     0    0     0   0
## 4      0          0    0    0    0   0      0     0    0     0    0     0   1
## 5      0          0    1    0    0   1      0     0    0     0    0     0   0
## 6      0          0    0    0    0   0      0     0    0     1    0     0   0
##   get flatter look everi color time wear fabric great compliment qualiti person
## 1   0       0    0     0     0    0    0      0     0          0       0      0
## 2   0       0    0     0     0    0    0      0     0          0       0      0
## 3   0       0    0     0     0    0    0      0     0          0       0      0
## 4   1       0    0     1     0    1    1      0     1          1       0      0
## 5   0       1    0     0     0    0    1      0     0          0       0      0
## 6   0       0    0     0     1    0    1      0     0          0       0      0
##   happi shirt front perfect leg pair dress one tall lot skirt long full take
## 1     0     0     0       0   0    0     0   0    0   0     0    0    0    0
## 2     0     0     0       0   0    0     0   0    0   0     0    0    0    0
## 3     0     0     0       0   0    0     0   0    0   0     0    0    0    0
## 4     0     0     0       0   0    0     0   0    0   0     0    0    0    0
## 5     0     2     1       1   1    1     0   0    0   0     0    0    0    0
## 6     0     0     0       0   0    0     1   1    1   1     2    1    1    1
##   return jean wash show better navi almost someth usual_wear white red loos
## 1      0    0    0    0      0    0      0      0          0     0   0    0
## 2      0    0    0    0      0    0      0      0          0     0   0    0
## 3      0    0    0    0      0    0      0      0          0     0   0    0
## 4      0    0    0    0      0    0      0      0          0     0   0    0
## 5      0    0    0    0      0    0      0      0          0     0   0    0
## 6      1    0    0    0      0    0      0      0          1     0   0    0
##   love_color see went gorgeous sure tri issu decid review though good said
## 1          0   0    0        0    0   0    0     0      0      0    0    0
## 2          0   0    0        0    0   0    0     0      0      0    0    0
## 3          0   0    0        0    0   0    0     0      0      0    0    0
## 4          0   0    0        0    0   0    0     0      0      0    0    0
## 5          0   0    0        0    0   0    0     0      0      0    0    0
## 6          1   0    0        0    0   0    0     0      0      0    0    0
##   everyth versatil pant worn short make look_like underneath alway use mani bit
## 1       0        0    0    0     0    0         0          0     0   0    0   0
## 2       0        0    0    0     0    0         0          0     0   0    0   0
## 3       0        0    0    0     0    0         0          0     0   0    0   0
## 4       0        0    0    0     0    0         0          0     0   0    0   0
## 5       0        0    0    0     0    0         0          0     0   0    0   0
## 6       0        0    0    0     0    0         0          0     0   0    0   0
##   big sleev go end worth got quit sinc light buy feel think feel_like pictur
## 1   0     0  0   0     0   0    0    0     0   0    0     0         0      0
## 2   0     0  0   0     0   0    0    0     0   0    0     0         0      0
## 3   0     0  0   0     0   0    0    0     0   0    0     0         0      0
## 4   0     0  0   0     0   0    0    0     0   0    0     0         0      0
## 5   0     0  0   0     0   0    0    0     0   0    0     0         0      0
## 6   0     0  0   0     0   0    0    0     0   0    0     0         0      0
##   even huge sweater beauti run will snug back bust feminin retail order_size
## 1    0    0       0      0   0    0    0    0    0       0      0          0
## 2    0    0       0      0   0    0    0    0    0       0      0          0
## 3    0    0       0      0   0    0    0    0    0       0      0          0
## 4    0    0       0      0   0    0    0    0    0       0      0          0
## 5    0    0       0      0   0    0    0    0    0       0      0          0
## 6    0    0       0      0   0    0    0    0    0       0      0          0
##   lbs typic regular tee soft smaller thin longer summer area larger normal say
## 1   0     0       0   0    0       0    0      0      0    0      0      0   0
## 2   0     0       0   0    0       0    0      0      0    0      0      0   0
## 3   0     0       0   0    0       0    0      0      0    0      0      0   0
## 4   0     0       0   0    0       0    0      0      0    0      0      0   0
## 5   0     0       0   0    0       0    0      0      0    0      0      0   0
## 6   0     0       0   0    0       0    0      0      0    0      0      0   0
##   fine room sheer bra easili fit_perfect materi pull disappoint year shape
## 1    0    0     0   0      0           0      0    0          0    0     0
## 2    0    0     0   0      0           0      0    0          0    0     0
## 3    0    0     0   0      0           0      0    0          0    0     0
## 4    0    0     0   0      0           0      0    0          0    0     0
## 5    0    0     0   0      0           0      0    0          0    0     0
## 6    0    0     0   0      0           0      0    0          0    0     0
##   super flowi spring first look_great right made line print tts lace blue keep
## 1     0     0      0     0          0     0    0    0     0   0    0    0    0
## 2     0     0      0     0          0     0    0    0     0   0    0    0    0
## 3     0     0      0     0          0     0    0    0     0   0    0    0    0
## 4     0     0      0     0          0     0    0    0     0   0    0    0    0
## 5     0     0      0     0          0     0    0    0     0   0    0    0    0
## 6     0     0      0     0          0     0    0    0     0   0    0    0    0
##   pocket black chest came seem much enough problem boot size_small fit_well
## 1      0     0     0    0    0    0      0       0    0          0        0
## 2      0     0     0    0    0    0      0       0    0          0        0
## 3      0     0     0    0    0    0      0       0    0          0        0
## 4      0     0     0    0    0    0      0       0    0          0        0
## 5      0     0     0    0    0    0      0       0    0          0        0
## 6      0     0     0    0    0    0      0       0    0          0        0
##   especi sale price now purchas put figur way bodi still hip cute receiv can
## 1      0    0     0   0       0   0     0   0    0     0   0    0      0   0
## 2      0    0     0   0       0   0     0   0    0     0   0    0      0   0
## 3      0    0     0   0       0   0     0   0    0     0   0    0      0   0
## 4      0    0     0   0       0   0     0   0    0     0   0    0      0   0
## 5      0    0     0   0       0   0     0   0    0     0   0    0      0   0
## 6      0    0     0   0       0   0     0   0    0     0   0    0      0   0
##   side well_made thought uniqu t open larg part hem may blous drape wait come
## 1    0         0       0     0 0    0    0    0   0   0     0     0    0    0
## 2    0         0       0     0 0    0    0    0   0   0     0     0    0    0
## 3    0         0       0     0 0    0    0    0   0   0     0     0    0    0
## 4    0         0       0     0 0    0    0    0   0   0     0     0    0    0
## 5    0         0       0     0 0    0    0    0   0   0     0     0    0    0
## 6    0         0       0     0 0    0    0    0   0   0     0     0    0    0
##   pattern fit_great thing skinni arm probabl button shoulder give slight day
## 1       0         0     0      0   0       0      0        0    0      0   0
## 2       0         0     0      0   0       0      0        0    0      0   0
## 3       0         0     0      0   0       0      0        0    0      0   0
## 4       0         0     0      0   0       0      0        0    0      0   0
## 5       0         0     0      0   0       0      0        0    0      0   0
## 6       0         0     0      0   0       0      0        0    0      0   0
##   differ favorit jacket X5.4 without detail weight comfi winter fit_true two
## 1      0       0      0    0       0      0      0     0      0        0   0
## 2      0       0      0    0       0      0      0     0      0        0   0
## 3      0       0      0    0       0      0      0     0      0        0   0
## 4      0       0      0    0       0      0      0     0      0        0   0
## 5      0       0      0    0       0      0      0     0      0        0   0
## 6      0       0      0    0       0      0      0     0      0        0   0
##   true_size stretch recommend.1 sad need photo saw wore X5.3 yet tank piec felt
## 1         0       0           0   0    0     0   0    0    0   0    0    0    0
## 2         0       0           0   0    0     0   0    0    0   0    0    0    0
## 3         0       0           0   0    0     0   0    0    0   0    0    0    0
## 4         0       0           0   0    0     0   0    0    0   0    0    0    0
## 5         0       0           0   0    0     0   0    0    0   0    0    0    0
## 6         0       0           0   0    0     0   0    0    0   0    0    0    0
##   cut wide refer expect thick love_top actual extra boxi size_fit warm shorter
## 1   0    0     0      0     0        0      0     0    0        0    0       0
## 2   0    0     0      0     0        0      0     0    0        0    0       0
## 3   0    0     0      0     0        0      0     0    0        0    0       0
## 4   0    0     0      0     0        0      0     0    0        0    0       0
## 5   0    0     0      0     0        0      0     0    0        0    0       0
## 6   0    0     0      0     0        0      0     0    0        0    0       0
##   add anoth cloth neck amaz casual necklin unfortun might ador best m know hang
## 1   0     0     0    0    0      0       0        0     0    0    0 0    0    0
## 2   0     0     0    0    0      0       0        0     0    0    0 0    0    0
## 3   0     0     0    0    0      0       0        0     0    0    0 0    0    0
## 4   0     0     0    0    0      0       0        0     0    0    0 0    0    0
## 5   0     0     0    0    0      0       0        0     0    0    0 0    0    0
## 6   0     0     0    0    0      0       0        0     0    0    0 0    0    0
##   lightweight howev surpris heavi flow run_larg green easi low mayb denim slim
## 1           0     0       0     0    0        0     0    0   0    0     0    0
## 2           0     0       0     0    0        0     0    0   0    0     0    0
## 3           0     0       0     0    0        0     0    0   0    0     0    0
## 4           0     0       0     0    0        0     0    0   0    0     0    0
## 5           0     0       0     0    0        0     0    0   0    0     0    0
## 6           0     0       0     0    0        0     0    0   0    0     0    0</code></pre>
<pre class="r"><code>reviewtokensdf$recommend=factor(reviewtokensdf$recommend)</code></pre>
</div>
<div id="cart-model" class="section level4">
<h4>Cart Model</h4>
<p>First, we will use the CART algorithm for classification. First the complete tree is built and the optimum cp value is identified for which the error is minimum. Then, this cp value is used to obain the pruned tree. The pruned tree is plotted to understand the classification.</p>
<pre class="r"><code>## Build the CART model

tree=rpart(formula = recommend ~ ., data = reviewtokensdf,
           method=&quot;class&quot;, control=rpart.control(minsplit = 200, minbucket = 30, cp = 0.0001))

printcp(tree)</code></pre>
<pre><code>## 
## Classification tree:
## rpart(formula = recommend ~ ., data = reviewtokensdf, method = &quot;class&quot;, 
##     control = rpart.control(minsplit = 200, minbucket = 30, cp = 1e-04))
## 
## Variables actually used in tree construction:
##  [1] back       better     bit        can        color      comfort   
##  [7] decid      disappoint enough     fabric     fit        go        
## [13] great      huge       littl      look       look_like  love      
## [19] materi     medium     model      nice       perfect    pretti    
## [25] return     review     run        size       soft       tight     
## [31] unfortun   want       will      
## 
## Root node error: 4172/23486 = 0.17764
## 
## n= 23486 
## 
##            CP nsplit rel error  xerror     xstd
## 1  0.02492809      0   1.00000 1.00000 0.014040
## 2  0.01893576      2   0.95014 0.95230 0.013771
## 3  0.01078619      3   0.93121 0.93121 0.013649
## 4  0.00575264      4   0.92042 0.92042 0.013585
## 5  0.00383509      5   0.91467 0.91826 0.013572
## 6  0.00359540      6   0.91083 0.91707 0.013565
## 7  0.00335570     11   0.88998 0.91155 0.013532
## 8  0.00287632     12   0.88663 0.91299 0.013541
## 9  0.00239693     18   0.86697 0.90364 0.013484
## 10 0.00215724     21   0.85978 0.89573 0.013436
## 11 0.00167785     22   0.85762 0.89190 0.013413
## 12 0.00143816     25   0.85259 0.89453 0.013429
## 13 0.00119847     26   0.85115 0.89310 0.013420
## 14 0.00059923     28   0.84875 0.89477 0.013431
## 15 0.00051363     31   0.84660 0.89525 0.013434
## 16 0.00035954     38   0.84300 0.89741 0.013447
## 17 0.00034242     40   0.84228 0.89861 0.013454
## 18 0.00014382     48   0.83797 0.90508 0.013493
## 19 0.00010000     53   0.83725 0.90652 0.013502</code></pre>
<pre class="r"><code>plotcp(tree)</code></pre>
<p><img src="/post/2020-03-29-lasso-logistic-regression_files/figure-html/cart-model-1.png" width="70%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>## Prune down the tree
bestcp=tree$cptable[which.min(tree$cptable[,&quot;xerror&quot;]),&quot;CP&quot;]
bestcp</code></pre>
<pre><code>## [1] 0.001677852</code></pre>
<pre class="r"><code>ptree=prune(tree,cp=bestcp)

rpart.plot(ptree,cex = 0.6)</code></pre>
<p><img src="/post/2020-03-29-lasso-logistic-regression_files/figure-html/cart-model-2.png" width="70%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>prp(ptree, faclen = 0, cex = 0.5, extra = 2)</code></pre>
<p><img src="/post/2020-03-29-lasso-logistic-regression_files/figure-html/cart-model-3.png" width="70%" style="display: block; margin: auto;" /></p>
<p>AS can be seen from the tree plot, words like “return”, “disappoint”, “back”, “huge”, etc are used by unhappy customers – i.e., customers who do not recommend the product.</p>
</div>
<div id="random-forest" class="section level4">
<h4>Random forest</h4>
<p>Next, we use Random forest. We examine the varimp plot of the randomforest model to understand which words affect the classification the most.</p>
<pre class="r"><code>reviewRF=randomForest(recommend~., data=reviewtokensdf)
varImpPlot(reviewRF, cex=.7)</code></pre>
<p>In sync with the CART model, the varimp plot of the Random forest model also indicates that “return”, and “disappoint” are the most important variables.</p>
</div>
<div id="lasso-logistic-regression" class="section level4">
<h4>Lasso logistic Regression</h4>
<p>The main challenge associated with text mining data frames is the very high number of columns or features.</p>
<p>WE will use Regularisation using lasso for feature reduction.</p>
<p>The odds ratio of the logistic regression model will throw several insights on classification.</p>
<pre class="r"><code># requires library(glmnet)

# convert training data to matrix format
x &lt;- model.matrix(recommend~.,reviewtokensdf)

# convert class to numerical variable
y &lt;- as.numeric(reviewtokensdf$recommend)

# perform grid search to find optimal value of lambda
cv.out &lt;- cv.glmnet(x,y,alpha=1,family=&quot;binomial&quot;,type.measure = &quot;mse&quot;)

# plot result
plot(cv.out)</code></pre>
<p><img src="/post/2020-03-29-lasso-logistic-regression_files/figure-html/lasso-logistic-regression-1.png" width="70%" style="display: block; margin: auto;" /></p>
<pre class="r"><code># min value of lambda
lambda_min &lt;- cv.out$lambda.min

# best value of lambda
lambda_lse &lt;- cv.out$lambda.1se
lambda_lse

# regression coefficients
coef=coef(cv.out,s=lambda_lse)
lassocoef=as.matrix(coef(cv.out,s=lambda_lse))
write.csv(lassocoef, &quot;lasso_coef.csv&quot;)</code></pre>
<p>Based on the lasso regression we arrive at the lambda_min that we need to use for the logistic regression.</p>
<p>Features which we need not include in the model have a coef of zero.</p>
<p align="center">
<img src="/post/2020-03-29-lasso-logistic-regression_files/coef.jpg" title="fig:" alt="coef" width="200" height="600" />
</p>
<p>We write the coefficients to a csv file.</p>
<p>The file is saved to the working directory.</p>
<p>If we filter on the coef columns for zero (column B), we find that 84 of the 285 features (x variables) have a coef of zero – i.e., these have been removed by the lasso model.</p>
<p>The reduced set of features is used to build the logistic regression model.</p>
<p>We calculate the odds ratio from the coefficients of the logistic regression model:</p>
<p><span class="math display">\[ Odds\: ratio\: = exp(coef(LR\: model)) \]</span></p>
<p>The odds ratio is a very unique advantage of probability based models like logisticc regression. The odds ratio is used to understand the influence of various x variables in classification.</p>
<pre class="r"><code># Find the best lambda using cross-validation
set.seed(123)
cv.lasso &lt;- cv.glmnet(x, y, alpha = 1, family = &quot;binomial&quot;)

# Fit the final model on the dataframe
review_logreg &lt;- glmnet(x, y, alpha = 1, family = &quot;binomial&quot;,
                        lambda = cv.lasso$lambda.min)

# Save the regression coef to a ccsv file
logregcoef=as.matrix(coef(review_logreg))
odds_ratio=as.matrix(exp(coef(review_logreg)))
write.csv(logregcoef, &quot;logreg_coef.csv&quot;)
write.csv(odds_ratio, &quot;odds_ratio.csv&quot;)</code></pre>
<p>Again, we write to a csv file for better understanding.</p>
<p>If the csv file for odds ratio is sorted based on the odds ratio (column B) in descending order, we can see the variables with the highest odds ratio</p>
<p align="center">
<img src="/post/2020-03-29-lasso-logistic-regression_files/odds-ratio.jpg" title="fig:" alt="odds-ratio" width="200" height="600" />
</p>
<p>The odds ratio is interpred as follows: A product which has “compliment” in its review has 5.61 times more odds to be recommended compared to a product review which does not have the word.</p>
<p>We can examine the logreg_coef.csv file to understand variables with negative coefficients.</p>
<p align="center">
<img src="/post/2020-03-29-lasso-logistic-regression_files/dissapoint.jpg" title="fig:" alt="dissapoint" width="200" height="600" />
</p>
<p>The term “disappoint” has a negative coefficient indicating that, if the term is present in the review, the probability the product will be recommended is very low.</p>
<p>The 3 classification models throw similar insights in terms of what terms are used by happy customers who will recommend a product vs those use by unhappy customers.</p>
<p>These provide vital leads to improving product/service quality.</p>
</div>
<div id="conclusion" class="section level4">
<h4>Conclusion</h4>
<p>The article covers only the tip of the iceberg of the concepts of text mining.</p>
<p>The main objective of the article is to get readers introducted to the concepts of text mining.</p>
</div>
